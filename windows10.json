{
  "variables": {
    "DATE": null,
    "EDITION": null,
    "RELEASE": null,
    "ISO_PATH": null,
    "ISO_FILE": null,
    "ISO_CHECKSUM": null,
    "NAME": "windows10{{ user `EDITION` }}-{{ user `RELEASE` }}-{{ user `DATE` }}",
    "OUTPUT_ROOT": "./output",
    "HEADLESS": "true"
  },
  "builders": [{
    "name": "{{ user `NAME` }}",
    "vm_name": "{{ user `NAME` }}",
    "type": "vmware-iso",
    "guest_os_type": "windows9-64",
    "headless": "{{ user `HEADLESS`}}",
    "output_directory": "{{ user `OUTPUT_ROOT` }}/{{ user `NAME` }}/",
    "http_directory": "http",
    "iso_url": "{{ user `ISO_PATH` }}/{{ user `ISO_FILE` }}",
    "iso_checksum_type": "sha256",
    "iso_checksum": "{{ user `ISO_CHECKSUM` }}",

    "communicator":"winrm",
    "winrm_username": "administrator",
    "winrm_password": "ansible",
    "winrm_timeout": "8h",
    "winrm_use_ntlm": true,
    "winrm_use_ssl": true,
    "winrm_insecure": true,

    "cpus": 2,
    "cores": 1,
    "memory": 4096,
    "disk_adapter_type": "lsisas1068",
    "version": "11",

    "vmx_data": {
      "hpet0.present": "TRUE",
      "gui.fitGuestUsingNativeDisplayResolution": "FALSE"
    },
    "vmx_data_post": {
      "ide1:0.startConnected": "FALSE",
      "ide1:0.clientDevice": "TRUE",
      "ethernet0.virtualDev": "vmxnet3"
    },

    "shutdown_command": "shutdown /s /t 10 /f /d p:4:1 /c \"Packer Shutdown\"",
    "shutdown_timeout": "1h",
    "floppy_files": [
      "scripts/10-{{ user `EDITION` }}/autounattend.xml",
      "scripts/microsoft-updates.bat",
      "scripts/win-updates.ps1",
      "scripts/software/ansible.ps1"
     ]
  }],
  "provisioners": [
    {
      "type": "powershell",
      "script": "scripts/software/vmware.ps1"
    },
    {
      "type": "powershell",
      "script": "scripts/smb.ps1"
    },
    {
      "type": "powershell",
      "script": "scripts/rdp.ps1"
    },
    {
      "type": "powershell",
      "script": "scripts/powerconfig.bat"
    },
    {
      "type": "powershell",
      "script": "scripts/cleanup.ps1"
    }
  ]
}
